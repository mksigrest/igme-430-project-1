<html lang="en">

<head>
    <meta charset="utf-8"/>
    <title>Country Api Docs</title>
    <link rel="stylesheet" type="text/css" href="/client.css" />
</head>

<body>
    <header><h1>Country Api Docs</h1></header>
    <br />
    <div class="content">

        <div class="endpoint">
            <h3>getCountryName</h3>
            <label for="region">Region: </label>
            <input class="regionField" type="text" />
            <label for="capital">Capital: </label>
            <input class="capitalField" type="text" />
            <select id="nameMethodSelect">
                <option value="get">GET</option>
                <option value="head">HEAD</option>
            </select>
            <button id="nameSubmit">Get Country Name</button>
        </div>
        <div id="nameOutput">
        </div>
        <br />

        <div class="endpoint">
            <h3>getCountryLocation</h3>
            <label for="name">Name: </label>
            <input class="nameField" type="text" />
            <label for="capital">Capital: </label>
            <input class="capitalField" type="text" />
            <select id="locationMethodSelect">
                <option value="get">GET</option>
                <option value="head">HEAD</option>
            </select>
            <button id="locationSubmit">Get Country Location</button>
        </div>
        <div id="locationOutput">
        </div>
        <br />

        <div class="endpoint">
            <h3>getCountryFinance</h3>
            <label for="name">Name: </label>
            <input class="nameField" type="text" />
            <label for="capital">Capital: </label>
            <input class="capitalField" type="text" />
            <select id="financeMethodSelect">
                <option value="get">GET</option>
                <option value="head">HEAD</option>
            </select>
            <button id="financeSubmit">Get Country Finances</button>
        </div>
        <div id="financeOutput">
        </div>
        <br />

        <div class="endpoint">
            <h3>getAllCountries</h3>
            <select id="allMethodSelect">
                <option value="get">GET</option>
                <option value="head">HEAD</option>
            </select>
            <button id="allSubmit">Get All Countries</button>
        </div>
        <div id="allOutput">
        </div>
        <br />

        <div class="endpoint">
            <h3>addCountry</h3>
            <label for="name">Name: </label>
            <input class="nameField" type="text" />
            <label for="capital">Capital: </label>
            <input class="capitalField" type="text" />
            <label for="long">Longitude: </label>
            <input class="longField" type="text" />
            <label for="latit">Latitude: </label>
            <input class="latitudeField" type="text" />
            <button id="addSubmit">Add Country</button>
        </div>
        <div id="addOutput">
        </div>
        <br />

        <div class="endpoint">
            <h3>editCapital</h3>
            <label for="name">Name: </label>
            <input class="nameField" type="text" />
            <label for="capital">Capital: </label>
            <input class="capitalField" type="text" />
            <label for="newCapital">New Capital: </label>
            <input class="newCapitalField" type="text" />
            <button id="editSubmit">Edit Country Capital</button>
        </div>
        <div id="editOutput">
        </div>

    </div>
</body>
<script>
    document.getElementById('nameSubmit').addEventListener('click', async (e) => {
        e.preventDefault();

        const endpoint = document.getElementById('nameSubmit').closest('.endpoint');
        const region = endpoint.querySelector('.regionField').value.trim();
        const capital = endpoint.querySelector('.capitalField').value.trim();

        const params = new URLSearchParams();
        if (region) params.append('region', region);
        if (capital) params.append('capital', capital);

        const url = '/api/getCountryName' + (params.toString() ? `?${params.toString()}` : '');
        const method = document.getElementById('nameMethodSelect').value.toUpperCase();
        const response = await fetch(url, { method });
        const nameOutput = document.getElementById('nameOutput');

        if (method !== 'HEAD') {
            if (response.ok) {
                const data = await response.json();

                const list = data.map(c => {
                    const displayName = (c.name && (c.name.common || c.name))
                    return `<li><strong>${displayName}</strong></li>`;
                }).join('');
                nameOutput.innerHTML = `<strong>Found ${data.length}</strong><ul>${list}</ul>`;
                console.log(data);
            }
            else {
                const error = await response.json();
                nameOutput.innerHTML = `<strong>Not Found</strong> <br> <br> Message: ${error.message}`;
                console.log(error);
            }
        }
        else {
            if (response.ok) {
                nameOutput.innerHTML = `<strong>Success</strong>`
            }
            else {
                nameOutput.innerHTML = `<strong>Not Found</strong>`
            }
        }
    })

    document.getElementById('locationSubmit').addEventListener('click', async (e) => {
        e.preventDefault();

        const endpoint = document.getElementById('locationSubmit').closest('.endpoint');
        const name = endpoint.querySelector('.nameField').value.trim();
        const capital = endpoint.querySelector('.capitalField').value.trim();

        const params = new URLSearchParams();
        if (name) params.append('name', name);
        if (capital) params.append('capital', capital);

        const url = '/api/getCountryLocation' + (params.toString() ? `?${params.toString()}` : '');
        const method = document.getElementById('locationMethodSelect').value.toUpperCase();
        const response = await fetch(url, { method });
        const locationOutput = document.getElementById('locationOutput');

        if (method !== 'HEAD') {
            if (response.ok) {
                const data = await response.json();

                const list = data.map(c => {
                    const displayName = (c.name && (c.name.common || c.name))
                    const displayLat = (c.latitude);
                    const displayLog = (c.longitude);
                    return `<li><strong>${displayName}</strong> - Lat: ${displayLat} - Long: ${displayLog}</li>`;
                }).join('');
                locationOutput.innerHTML = `<strong>Found ${data.length}</strong><ul>${list}</ul>`;
                console.log(data);
            }
            else {
                const error = await response.json();
                locationOutput.innerHTML = `<strong>Not Found</strong> <br> <br> Message: ${error.message}`;
                console.log(error);
            }
        }
        else {
            if (response.ok) {
                locationOutput.innerHTML = `<strong>Success</strong>`
            }
            else {
                locationOutput.innerHTML = `<strong>Not Found</strong>`
            }
        }
    })

    document.getElementById('financeSubmit').addEventListener('click', async (e) => {
        e.preventDefault();

        const endpoint = document.getElementById('financeSubmit').closest('.endpoint');
        const name = endpoint.querySelector('.nameField').value.trim();
        const capital = endpoint.querySelector('.capitalField').value.trim();

        const params = new URLSearchParams();
        if (name) params.append('name', name);
        if (capital) params.append('capital', capital);

        const url = '/api/getCountryFinance' + (params.toString() ? `?${params.toString()}` : '');
        const method = document.getElementById('financeMethodSelect').value.toUpperCase();
        const response = await fetch(url, { method });
        const financeOutput = document.getElementById('financeOutput');

        if (method !== 'HEAD') {
            if (response.ok) {
                const data = await response.json();

                const list = data.map(c => {
                    const displayName = (c.name && (c.name.common || c.name))
                    const displayCurName = (c.finance.currency_name);
                    const displayCurSym = (c.finance.currency_symbol);
                    return `<li><strong>${displayName}</strong> - Currency Name: ${displayCurName} - Currency Symbol: ${displayCurSym}</li>`;
                }).join('');
                financeOutput.innerHTML = `<strong>Found ${data.length}</strong><ul>${list}</ul>`;
                console.log(data);
            }
            else {
                const error = await response.json();
                locationOutput.innerHTML = `<strong>Not Found</strong> <br> <br> Message: ${error.message}`;
                console.log(error);
            }
        }
        else {
            if (response.ok) {
                locationOutput.innerHTML = `<strong>Success</strong>`
            }
            else {
                locationOutput.innerHTML = `<strong>Not Found</strong>`
            }
        }
    })

    document.getElementById('allSubmit').addEventListener('click', async (e) => {
        e.preventDefault();

        const url = '/api/getAllCountries';
        const method = document.getElementById('allMethodSelect').value.toUpperCase();
        const response = await fetch(url, { method });
        const allOutput = document.getElementById('allOutput');

        if (method !== 'HEAD') {
            if (response.ok) {
                const data = await response.json();
                allOutput.innerHTML = `<strong>Success</strong> <br> <br> ${JSON.stringify(data)}`;
                console.log(data);
            }
            else {
                const error = await response.json();
                allOutput.innerHTML = `<strong>Not Found</strong> <br> <br> Message: ${error.message}`;
                console.log(error);
            }
        }
        else {
            if (response.ok) {
                allOutput.innerHTML = `<strong>Success</strong>`
            }
            else {
                allOutput.innerHTML = `<strong>Not Found</strong>`
            }
        }
    })

    document.getElementById('addSubmit').addEventListener('click', async (e) => {
        e.preventDefault();
        const endpoint = document.getElementById('addSubmit').closest('.endpoint');

        const body = {
            name: endpoint.querySelector('.nameField').value.trim();
            capital: endpoint.querySelector('.capitalField').value.trim();
        }

        
        const name = 
        const capital = 
        const longitude = endpoint.querySelector('.longField').value.trim();
        const latitude = endpoint.querySelector('.latitField').value.trim();

        const url = '/api/addCountry';
        const response = await fetch(url, { method });
        const addOutput = document.getElementById('addOutput');

        
    })
</script>
</html>